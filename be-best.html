
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Be Best - Lab &#8212; Explorations!?</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The Oh No! - Lab" href="oh-no.html" />
    <link rel="prev" title="The Please Don’t Eat Me - Lab" href="dont-eat-me.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Explorations!?</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="introduction.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Assignments
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="python.html">
   Introduction to python - Lab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="explorationlib.html">
   Introduction to
   <em>
    explorationlib
   </em>
   - Lab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="therunaround.html">
   The Runaround - Lab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sniff%21.html">
   The Sniff! - Lab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="air-quotes.html">
   The Air Quotes Cognition - Lab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dont-eat-me.html">
   The Please Don’t Eat Me - Lab
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   The Be Best - Lab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="oh-no.html">
   The Oh No! - Lab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="follow-my-directed.html">
   The Follow the Directed - Lab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="oh-info.html">
   The Oh My Info - Lab
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/be-best.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/parenthetical-e/explorations-book/main?urlpath=tree/book/be-best.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/parenthetical-e/explorations-book/blob/main/book/be-best.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-and-import-needed-modules">
   Install and import needed modules
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-1-our-friend-the-bandit">
   Section 1 - Our friend, the bandit.
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-base-case-section-1">
     The base case (Section 1)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#our-three-agents-unbounded">
     Our three agents,
     <em>
      unbounded
     </em>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#plot-action-choices">
       Plot action choices
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#question-1-1">
       Question 1.1
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#question-1-2">
       Question 1.2
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#question-1-3">
       Question 1.3
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#meet-our-dilemma">
       Meet our dilemma
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#question-1-4">
       Question 1.4
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#question-1-5">
       Question 1.5
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-2-bounds-and-bandits">
   Section 2 - Bounds and bandits
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#question-2-1">
     Question 2.1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#our-training-base-case-section-2">
     Our (training) base case (Section 2)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-tune-up">
     A tune up
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#question-2-2-ep-tuning">
       Question 2.2 - Ep tuning.
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#question-2-4">
     Question 2.4
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#question-2-5">
       Question 2.5
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#question-2-6">
       Question 2.6
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#our-reporting-base-case-section-2">
     Our reporting base case (Section 2)
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#question-2-7">
       Question 2.7
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#question-2-8-the-big-conclusion">
       Question 2.8 - the big conclusion!
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="the-be-best-lab">
<h1>The Be Best - Lab<a class="headerlink" href="#the-be-best-lab" title="Permalink to this headline">¶</a></h1>
<p>In this assignment we study exploration in the very abstract <span class="math notranslate nohighlight">\(n\)</span>-armed bandit ask. In this there are <span class="math notranslate nohighlight">\(n\)</span> actions to take. Each returns a reward <span class="math notranslate nohighlight">\(R\)</span>, with some probability <span class="math notranslate nohighlight">\(p\)</span>. The reward value is either a 1 or a 0. This means the expected value of each arm is simply probability. Nice and simple right?</p>
<p>Our agents are really learning, at last. Reinforcement learning, to be precise.</p>
<p>The reward value <span class="math notranslate nohighlight">\(Q\)</span> update rule for all agents (below) and arm is the same:</p>
<p>$<span class="math notranslate nohighlight">\( Q \leftarrow Q + \alpha * (R - Q) \)</span>$ [1]</p>
<p>Where the learning rate <em>lr_reward</em> is denoted as <span class="math notranslate nohighlight">\(\alpha\)</span>, so that the equation above looks nice. The learning rate often gets called <span class="math notranslate nohighlight">\(\alpha\)</span> in the reinforcement learning world. If you are not familiar with the idea of a learning rate, it is what it sounds like. A parameter that controls how much each value update matters. This is, over time, the rate at which learning happens.</p>
<p>Remember too that <span class="math notranslate nohighlight">\(Q\)</span> is trying to approximate the average reward value of each arm.</p>
<p>This kind of difference <span class="math notranslate nohighlight">\((R - Q)\)</span> in Eq [1] is typical of RL. If you’re not sure what it means, consider in your head, what would happen to the value update if <span class="math notranslate nohighlight">\(Q\)</span> was bigger than the reward <span class="math notranslate nohighlight">\(R\)</span> (and overestimate), or if it was smaller. Once you have noodled that a bit, as needed, consider how making <span class="math notranslate nohighlight">\(\alpha\)</span> bigger or smaller might make <span class="math notranslate nohighlight">\(Q\)</span> learning faster, or slower, or more or less volatile. (Learning speed and volatility <em>often</em> go together; an annoying matched set.)</p>
<p><em>Note</em>: We are not going to use <span class="math notranslate nohighlight">\(\alpha\)</span> here. Just giving you some intuition. We will use it soon…</p>
<p>Our exploration strategies are a random one, a sequential one, or <span class="math notranslate nohighlight">\(\epsilon\)</span>-greedy (aka ‘e’-greedy).</p>
<p>The random one, and the sequential one, will come in two flavors. One that just explores, with no attempt to exploit. And one who’s pure exploration is bound. Bounded by the number of steps of exploration that are allowed. Once that bound is exceeded, then both the Bounded agents will choose the arm they think is most valuable forevermore. Forevermore!</p>
<p>The lab has two sections.</p>
<ul class="simple">
<li><p><em>First</em> is a demo mostly. We will explore 4-armed bandits, and get to know our three basic agents.</p></li>
<li><p><em>Second</em>, is where things get more interesting. We’ll put <span class="math notranslate nohighlight">\(\epsilon\)</span>=greedy, and the two bounded agents, in a little competition. The big question is this: tremendous effort has gone in over the years to study bandits when the exploration-exploitation dilemma is in play. The question this week is a doozy: was all work even necessary?</p></li>
</ul>
<p>Or to say it more directly: What is the cost in terms of rewards found to doing pure exploration, with a bound.</p>
<p>In some ways this is not a fair competition in Section 2. Or really, in many ways. The <span class="math notranslate nohighlight">\(\epsilon\)</span>-greedy method is not the best known solution to trading off exploration with exploitation. Then again, it is widely used to this day. It’s a place to start to ask this, our big question, anyway. We’ll come back to it next week, and try to be more fancy.</p>
<p>Our metric is <em>total reward</em>. Maximizing that is the goal of all RL, afterall.</p>
<div class="section" id="install-and-import-needed-modules">
<h2>Install and import needed modules<a class="headerlink" href="#install-and-import-needed-modules" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install explorationlib?</span>
<span class="o">!</span>pip install --upgrade git+https://github.com/parenthetical-e/explorationlib
<span class="o">!</span>pip install --upgrade git+https://github.com/MattChanTK/gym-maze.git
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">explorationlib</span>

<span class="kn">from</span> <span class="nn">explorationlib.local_gym</span> <span class="kn">import</span> <span class="n">BanditUniform4</span>
<span class="kn">from</span> <span class="nn">explorationlib.agent</span> <span class="kn">import</span> <span class="n">BanditActorCritic</span>
<span class="kn">from</span> <span class="nn">explorationlib.agent</span> <span class="kn">import</span> <span class="n">Critic</span>
<span class="kn">from</span> <span class="nn">explorationlib.agent</span> <span class="kn">import</span> <span class="n">EpsilonActor</span>
<span class="kn">from</span> <span class="nn">explorationlib.agent</span> <span class="kn">import</span> <span class="n">RandomActor</span>
<span class="kn">from</span> <span class="nn">explorationlib.agent</span> <span class="kn">import</span> <span class="n">SequentialActor</span>
<span class="kn">from</span> <span class="nn">explorationlib.agent</span> <span class="kn">import</span> <span class="n">BoundedRandomActor</span>
<span class="kn">from</span> <span class="nn">explorationlib.agent</span> <span class="kn">import</span> <span class="n">BoundedSequentialActor</span>

<span class="kn">from</span> <span class="nn">explorationlib.run</span> <span class="kn">import</span> <span class="n">experiment</span>
<span class="kn">from</span> <span class="nn">explorationlib.score</span> <span class="kn">import</span> <span class="n">total_reward</span>
<span class="kn">from</span> <span class="nn">explorationlib.score</span> <span class="kn">import</span> <span class="n">action_entropy</span>
<span class="kn">from</span> <span class="nn">explorationlib.util</span> <span class="kn">import</span> <span class="n">select_exp</span>
<span class="kn">from</span> <span class="nn">explorationlib.util</span> <span class="kn">import</span> <span class="n">load</span>
<span class="kn">from</span> <span class="nn">explorationlib.util</span> <span class="kn">import</span> <span class="n">save</span>

<span class="kn">from</span> <span class="nn">explorationlib.plot</span> <span class="kn">import</span> <span class="n">plot_bandit</span>
<span class="kn">from</span> <span class="nn">explorationlib.plot</span> <span class="kn">import</span> <span class="n">plot_bandit_actions</span>
<span class="kn">from</span> <span class="nn">explorationlib.plot</span> <span class="kn">import</span> <span class="n">plot_bandit_critic</span>
<span class="kn">from</span> <span class="nn">explorationlib.plot</span> <span class="kn">import</span> <span class="n">plot_bandit_hist</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pretty plots</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format=&#39;retina&#39;
<span class="o">%</span><span class="k">config</span> IPCompleter.greedy=True
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.facecolor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.facecolor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;16&quot;</span>

<span class="c1"># Dev</span>
<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="section-1-our-friend-the-bandit">
<h2>Section 1 - Our friend, the bandit.<a class="headerlink" href="#section-1-our-friend-the-bandit" title="Permalink to this headline">¶</a></h2>
<p>In this section we’ll study three explorers getting to know one bandit, with four arms.</p>
<div class="section" id="the-base-case-section-1">
<h3>The base case (Section 1)<a class="headerlink" href="#the-base-case-section-1" title="Permalink to this headline">¶</a></h3>
<p>Let’s make a four armed bandit and then plot its values. (Expected value is the term used in the literature, so I will too).</p>
<p><em>Note</em>: The random seed is fixed. If you change the see and run the cell below, some of the reward probabilities will change. The probability of the best arm, the optimal value arm is fixed however. It is set to 0.35, and located at arm 2. Try it! Rerun the cell below with different seeds, a few times, to get a sense of how the non-optimal arms can vary.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Shared env params</span>
<span class="n">num_experiments</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">5030</span>

<span class="c1"># Create env</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">BanditUniform4</span><span class="p">(</span><span class="n">p_min</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">p_max</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">p_best</span><span class="o">=</span><span class="mf">0.35</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

<span class="c1"># Plot env</span>
<span class="n">plot_bandit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="our-three-agents-unbounded">
<h3>Our three agents, <em>unbounded</em><a class="headerlink" href="#our-three-agents-unbounded" title="Permalink to this headline">¶</a></h3>
<p>A word about the code. Our agents this week work in whaat gets called an ActorCritic desgin. This breaks reinforcement learning algorithms in two two parts, obviously. The Actor does action selection. The Critic estimates the value of each action.</p>
<p>Now in normal reinforcement learning, aka not pure exploration, the <em>Actor</em> uses the <span class="math notranslate nohighlight">\(Q\)</span> value estimates from the <em>Critic</em> to, in part, make its decisions. Be it explore or exploit. This is indeed the case for the <span class="math notranslate nohighlight">\(\epsilon\)</span>-greedy agent, <em>EpsilonActor</em>, works.</p>
<p>…But…</p>
<p>The other two agents–<em>SequentialActor</em> and <em>RandomActor</em>–don’t explore with value. The are both <em>max entropy</em> action systems, who don’t care about reward value or learning <em>at all</em>. I have kept the <em>ActorCritic</em> style because it was easy to implement in <em>explorationlib</em>. Don’t be misled.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ran</span> <span class="o">=</span> <span class="n">BanditActorCritic</span><span class="p">(</span>
    <span class="n">RandomActor</span><span class="p">(</span><span class="n">num_actions</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">num_arms</span><span class="p">),</span>
    <span class="n">Critic</span><span class="p">(</span><span class="n">num_inputs</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">num_arms</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">seq</span> <span class="o">=</span> <span class="n">BanditActorCritic</span><span class="p">(</span>
    <span class="n">SequentialActor</span><span class="p">(</span><span class="n">num_actions</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">num_arms</span><span class="p">),</span>
    <span class="n">Critic</span><span class="p">(</span><span class="n">num_inputs</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">num_arms</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">epy</span> <span class="o">=</span> <span class="n">BanditActorCritic</span><span class="p">(</span>
    <span class="n">EpsilonActor</span><span class="p">(</span><span class="n">num_actions</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">num_arms</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span>
    <span class="n">Critic</span><span class="p">(</span><span class="n">num_inputs</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">num_arms</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># -</span>
<span class="n">agents</span> <span class="o">=</span> <span class="p">[</span><span class="n">ran</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">epy</span><span class="p">]</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;random&quot;</span><span class="p">,</span> <span class="s2">&quot;sequential&quot;</span><span class="p">,</span> <span class="s2">&quot;ep-greedy&quot;</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;purple&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s run out our three agents on the <em>env</em> from our base, and plot some things about them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_steps</span> <span class="o">=</span> <span class="mi">12</span>  <span class="c1"># Three rounds per arm, about that anyway</span>

<span class="c1"># !</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">agent</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">agents</span><span class="p">):</span>
    <span class="n">log</span> <span class="o">=</span> <span class="n">experiment</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{name}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">agent</span><span class="p">,</span>
        <span class="n">env</span><span class="p">,</span>
        <span class="n">num_steps</span><span class="o">=</span><span class="n">num_steps</span><span class="p">,</span>
        <span class="n">num_experiments</span><span class="o">=</span><span class="n">num_experiments</span><span class="p">,</span>
        <span class="n">dump</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">split_state</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="plot-action-choices">
<h4>Plot action choices<a class="headerlink" href="#plot-action-choices" title="Permalink to this headline">¶</a></h4>
<p>with time (aka steps).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_experiment</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="n">plot_bandit_actions</span><span class="p">(</span>
        <span class="n">select_exp</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">num_experiment</span><span class="p">),</span> 
        <span class="n">num_arms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> 
        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>histograms action probability (aka arm choice).</p>
<p><em>Note</em>: The flatter these plots are, the closer they are to <em>maximum entropy</em> exploration behavior. I added a measure of the actual entropy to the title of each plot, to make it easier to compare.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_experiment</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="n">ent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">action_entropy</span><span class="p">(</span><span class="n">res</span><span class="p">)),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">plot_bandit_hist</span><span class="p">(</span>
        <span class="n">select_exp</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">num_experiment</span><span class="p">),</span> 
        <span class="n">bins</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{name}</span><span class="s2"> (ent </span><span class="si">{ent}</span><span class="s2">)&quot;</span><span class="p">,</span> 
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="question-1-1">
<h4>Question 1.1<a class="headerlink" href="#question-1-1" title="Permalink to this headline">¶</a></h4>
<p>How max entropy is max entropy sampling? If we ran the above 100 times, using different random seeds to the env and agents, would the measured entropy of random–who is max entropy asymptotically–ever exceed the sequential explorer?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write your answer here, as a comment. Explain yourself.</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s find out….</p>
<div class="cell tag_outputPrepend docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">agent</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">agents</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]):</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">env</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">exp</span> <span class="o">=</span> <span class="n">experiment</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{name}</span><span class="s2">_</span><span class="si">{i}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">agent</span><span class="p">,</span>
            <span class="n">env</span><span class="p">,</span>
            <span class="n">num_steps</span><span class="o">=</span><span class="n">num_steps</span><span class="p">,</span>
            <span class="n">num_experiments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">dump</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">split_state</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">action_entropy</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
        <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>
    <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">scores</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Action entropy&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="question-1-2">
<h4>Question 1.2<a class="headerlink" href="#question-1-2" title="Permalink to this headline">¶</a></h4>
<p>Was your guess in Question 1.1 right? If it was, good job. If your guess was wrong, do you know why? Explain as best you can please.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write your answer here, as a comment. Explain yourself.</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="question-1-3">
<h4>Question 1.3<a class="headerlink" href="#question-1-3" title="Permalink to this headline">¶</a></h4>
<p>Given what you have seen in Question 1.1, does random sampling seem more lesss like a good idea than sequential sampling. In other words, if you had to pick one be your own personal bandit explorer, which one would it be?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write your answer here, as a comment. Explain yourself.</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="meet-our-dilemma">
<h4>Meet our dilemma<a class="headerlink" href="#meet-our-dilemma" title="Permalink to this headline">¶</a></h4>
<p>Should I explore? Should I exploit it!? OMG I DON’T KNOW, says space crab.</p>
<p>….I’ll flip a weight coin,</p>
<p>…who’s weight has a name. It’s <span class="math notranslate nohighlight">\(\epsilon\)</span>!</p>
<p>The smaller <span class="math notranslate nohighlight">\(\epsilon\)</span> is, the less likely the coin flip comes up “EXPLORE’’. The more likely it comes up on the “EXPLOIT” side. If one chooses the exploit side, one is being greedy, right? The bigger <span class="math notranslate nohighlight">\(\epsilon\)</span> the more likely the coin will say “EXPLORE ‘’. Etc.</p>
<p>Let’s play with <span class="math notranslate nohighlight">\(\epsilon\)</span>-greedy, on our base case.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_steps</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">epsilons</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]</span>

<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">epsilon</span><span class="p">)</span> <span class="k">for</span> <span class="n">epsilon</span> <span class="ow">in</span> <span class="n">epsilons</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mediumpurple&quot;</span><span class="p">,</span> <span class="s2">&quot;mediumorchid&quot;</span><span class="p">,</span> <span class="s2">&quot;mediumvioletred&quot;</span><span class="p">]</span>

<span class="c1"># !</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">epsilons</span><span class="p">)):</span>
    <span class="n">agent</span> <span class="o">=</span> <span class="n">BanditActorCritic</span><span class="p">(</span>
        <span class="n">EpsilonActor</span><span class="p">(</span><span class="n">num_actions</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">num_arms</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="n">epsilon</span><span class="p">),</span>
        <span class="n">Critic</span><span class="p">(</span><span class="n">num_inputs</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">num_arms</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">log</span> <span class="o">=</span> <span class="n">experiment</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;ep_</span><span class="si">{name}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">agent</span><span class="p">,</span>
        <span class="n">env</span><span class="p">,</span>
        <span class="n">num_steps</span><span class="o">=</span><span class="n">num_steps</span><span class="p">,</span>
        <span class="n">num_experiments</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">dump</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">split_state</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Example behave. Change <em>num experiment</em> to see more examples (0, 99).</p>
<p><em>Note</em>: in every experiment we run in this lab, the optimal value arm is <em>always</em> arm 2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_experiment</span> <span class="o">=</span> <span class="mi">40</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="n">plot_bandit_actions</span><span class="p">(</span>
        <span class="n">select_exp</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">num_experiment</span><span class="p">),</span> 
        <span class="n">max_steps</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
        <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> 
        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Total reward</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Score</span>
<span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">total_reward</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>   

<span class="c1"># Tabulate</span>
<span class="n">m</span><span class="p">,</span> <span class="n">sd</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="n">sd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

<span class="c1"># Plot means</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sd</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Total reward&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epsilon&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Total reward&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Action entropy</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Score</span>
<span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">action_entropy</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>   

<span class="c1"># Tabulate</span>
<span class="n">m</span><span class="p">,</span> <span class="n">sd</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="n">sd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

<span class="c1"># Plot means</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sd</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Entropy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epsilon&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Entropy&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="question-1-4">
<h4>Question 1.4<a class="headerlink" href="#question-1-4" title="Permalink to this headline">¶</a></h4>
<p>In your own words explain how <span class="math notranslate nohighlight">\(\epsilon\)</span> seems to relate to <em>total reward</em> and <em>action entropy</em>. As <span class="math notranslate nohighlight">\(\epsilon\)</span> grows, what happens?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write your answer here, as a comment. Explain yourself.</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="question-1-5">
<h4>Question 1.5<a class="headerlink" href="#question-1-5" title="Permalink to this headline">¶</a></h4>
<p>Let’s ask this again from another direction. What relationship do you see between <em>total reward</em> and <em>action entropy</em>? To answer focus on the the two bar plots above, perhaps.</p>
<p>Can you explain this correlation in terms of explore-exploit, and the bandit problem we are trying to understand/solve? Is it strong or weak? Can you say why?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write your answer here, as a comment. Explain yourself.</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="section-2-bounds-and-bandits">
<h2>Section 2 - Bounds and bandits<a class="headerlink" href="#section-2-bounds-and-bandits" title="Permalink to this headline">¶</a></h2>
<p>In this section we’ll study two pure explorers with bounds. Our friend <span class="math notranslate nohighlight">\(\epsilon\)</span>-greedy returns, unchanged. Our friend <span class="math notranslate nohighlight">\(\epsilon\)</span>-greedy is a proxy for the question, “Does the explore-exploit dilemma even matter, for bandits?” We are going to give a (very very very) incomplete answer to this question by first tuning up our agents as best we can. Then, we put them in competition.</p>
<div class="section" id="question-2-1">
<h3>Question 2.1<a class="headerlink" href="#question-2-1" title="Permalink to this headline">¶</a></h3>
<p>Take a wild guess. Speculate. Use what little this lab has so far shown you. Does the dilemma matter? Will our friend <span class="math notranslate nohighlight">\(\epsilon\)</span>-greedy emerge the winner?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write your answer here, as a comment. Explain yourself.</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="our-training-base-case-section-2">
<h3>Our (training) base case (Section 2)<a class="headerlink" href="#our-training-base-case-section-2" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># DO NOT CHANGE:</span>

<span class="c1"># Shared env params</span>
<span class="n">num_experiments</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">593</span>  

<span class="c1"># Create env</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">BanditUniform4</span><span class="p">(</span><span class="n">p_min</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">p_max</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">p_best</span><span class="o">=</span><span class="mf">0.35</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

<span class="c1"># Plot env</span>
<span class="n">plot_bandit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="a-tune-up">
<h3>A tune up<a class="headerlink" href="#a-tune-up" title="Permalink to this headline">¶</a></h3>
<p>Let’s tune up each bandit, assuming 400 steps is an ok number.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_steps</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">num_experiments</span> <span class="o">=</span> <span class="mi">250</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="question-2-2-ep-tuning">
<h4>Question 2.2 - Ep tuning.<a class="headerlink" href="#question-2-2-ep-tuning" title="Permalink to this headline">¶</a></h4>
<p>What is the best <span class="math notranslate nohighlight">\(\epsilon\)</span>? (For this task).</p>
<p>The code below is a first try at tuning <em>EpsilonActor</em> and it’s only parameter <span class="math notranslate nohighlight">\(\epsilon\)</span>. Run it. Then use the code to try and narrow down a best choice for <span class="math notranslate nohighlight">\(\epsilon\)</span> in this environment. Put each attempt you make in a new cell, as a way to show your work. (Do not change <em>num steps</em> or <em>num experiments</em>, above).</p>
<p>Note: if you are having trouble, try plotting distributions instead of averages?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># CHANGE ME</span>
<span class="n">start</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="c1"># min 0</span>
<span class="n">stop</span> <span class="o">=</span> <span class="mf">0.99</span> <span class="c1"># max 1</span>
<span class="n">num_search</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># ?</span>

<span class="c1"># -</span>
<span class="c1"># LEAVE ME</span>
<span class="n">epsilons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">num_search</span><span class="p">)</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">epsilon</span> <span class="ow">in</span> <span class="n">epsilons</span><span class="p">]</span>

<span class="c1"># !</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">epsilons</span><span class="p">)):</span>
    <span class="n">agent</span> <span class="o">=</span> <span class="n">BanditActorCritic</span><span class="p">(</span>
        <span class="n">EpsilonActor</span><span class="p">(</span><span class="n">num_actions</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">num_arms</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="n">epsilon</span><span class="p">),</span>
        <span class="n">Critic</span><span class="p">(</span><span class="n">num_inputs</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">num_arms</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">log</span> <span class="o">=</span> <span class="n">experiment</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;ep_</span><span class="si">{name}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">agent</span><span class="p">,</span>
        <span class="n">env</span><span class="p">,</span>
        <span class="n">num_steps</span><span class="o">=</span><span class="n">num_steps</span><span class="p">,</span>
        <span class="n">num_experiments</span><span class="o">=</span><span class="n">num_experiments</span><span class="p">,</span>
        <span class="n">dump</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">split_state</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>

<span class="c1"># Score</span>
<span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">res</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">total_reward</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>   

<span class="c1"># Tabulate</span>
<span class="n">m</span><span class="p">,</span> <span class="n">sd</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">scores</span><span class="p">):</span>
    <span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="n">sd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

<span class="c1"># Plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sd</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Total reward&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epsilon&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your code goes here; Find the best ep!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># When you are done, write the best ep you found here as a comment</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="question-2-4">
<h3>Question 2.4<a class="headerlink" href="#question-2-4" title="Permalink to this headline">¶</a></h3>
<p>In the next question we’ll tune the bound; the number of pure exploration steps before pure exploitation begins. But first, let’s just the random pure explorer in action.</p>
<p>Starting from 100, change the <em>bound</em> below a few times, and plot the results-behave examples and reward distributions. Tell me what happens as the bound shrinks to 4 (aka one sample / arm, on average).</p>
<p><em>Note</em>: you can eyeball this, as I suggest, but it might be easier to write your own ‘for loop’ to see for sure?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bound</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># max 100</span>
<span class="n">ran</span> <span class="o">=</span> <span class="n">BanditActorCritic</span><span class="p">(</span>
    <span class="n">BoundedRandomActor</span><span class="p">(</span><span class="n">num_actions</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">num_arms</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">bound</span><span class="p">),</span>
    <span class="n">Critic</span><span class="p">(</span><span class="n">num_inputs</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">num_arms</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">experiment</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;example_bound&quot;</span><span class="p">,</span>
        <span class="n">ran</span><span class="p">,</span>
        <span class="n">env</span><span class="p">,</span>
        <span class="n">num_steps</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
        <span class="n">num_experiments</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">dump</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">split_state</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_bandit_actions</span><span class="p">(</span>
        <span class="n">select_exp</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> 
        <span class="n">max_steps</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
        <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">bound</span><span class="p">,</span> 
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">total_reward</span><span class="p">(</span><span class="n">exp</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="n">bound</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Total reward&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write your answer here, as a comment. Explain yourself.</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="question-2-5">
<h4>Question 2.5<a class="headerlink" href="#question-2-5" title="Permalink to this headline">¶</a></h4>
<p>What is the best <em>bound</em> (For this task).</p>
<p>The code below is a first try at tuning <em>BoundedRandomActor</em> and its only parameter <em>bound</em>. Run it. Then use the code to try and narrrow down a best choice for <span class="math notranslate nohighlight">\(\epsilon\)</span> at this environment. Put each attempt you make in a new cell, as a way to show your work. (Do not change <em>num steps</em> or <em>num experiments</em>, above).</p>
<p>Note: if you are having trouble, try plotting distributions instead of averages?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># CHANGE ME</span>
<span class="n">start</span> <span class="o">=</span> <span class="mi">4</span> <span class="c1"># min 4</span>
<span class="n">stop</span> <span class="o">=</span> <span class="n">num_steps</span> <span class="c1"># max num_steps</span>
<span class="n">num_search</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># ?</span>

<span class="c1"># -</span>
<span class="c1"># LEAVE ME</span>
<span class="n">bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">num_search</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">bound</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">bound</span> <span class="ow">in</span> <span class="n">bounds</span><span class="p">]</span>

<span class="c1"># !</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bound</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)):</span>
    <span class="n">agent</span> <span class="o">=</span> <span class="n">BanditActorCritic</span><span class="p">(</span>
        <span class="n">BoundedRandomActor</span><span class="p">(</span><span class="n">num_actions</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">num_arms</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">bound</span><span class="p">),</span>
        <span class="n">Critic</span><span class="p">(</span><span class="n">num_inputs</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">num_arms</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">log</span> <span class="o">=</span> <span class="n">experiment</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;b_</span><span class="si">{name}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">agent</span><span class="p">,</span>
        <span class="n">env</span><span class="p">,</span>
        <span class="n">num_steps</span><span class="o">=</span><span class="n">num_steps</span><span class="p">,</span>
        <span class="n">num_experiments</span><span class="o">=</span><span class="n">num_experiments</span><span class="p">,</span>
        <span class="n">dump</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">split_state</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>

<span class="c1"># Score</span>
<span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">res</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">total_reward</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>   

<span class="c1"># Tabulate</span>
<span class="n">m</span><span class="p">,</span> <span class="n">sd</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">scores</span><span class="p">):</span>
    <span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="n">sd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

<span class="c1"># Plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sd</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Total reward&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Bound&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your code goes here; Find the best bound!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># When you are done, write the best bound you found here as a comment</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="question-2-6">
<h4>Question 2.6<a class="headerlink" href="#question-2-6" title="Permalink to this headline">¶</a></h4>
<p>Note: we are only going to tune the bound for <em>BoundedRandomActor</em>, and we’ll rercycle this for <em>BoundedSequentialActor</em>. Can you guess why we are not optimizing both?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write your answer here, as a comment. Explain yourself.</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="our-reporting-base-case-section-2">
<h3>Our reporting base case (Section 2)<a class="headerlink" href="#our-reporting-base-case-section-2" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># DO NOT CHANGE:</span>

<span class="c1"># Shared env params</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">195</span>

<span class="c1"># Create env</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">BanditUniform4</span><span class="p">(</span><span class="n">p_min</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">p_max</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">p_best</span><span class="o">=</span><span class="mf">0.35</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

<span class="c1"># Plot env</span>
<span class="n">plot_bandit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="question-2-7">
<h4>Question 2.7<a class="headerlink" href="#question-2-7" title="Permalink to this headline">¶</a></h4>
<p>So, what’s a better way to maximize total reward in this (reporting) task? Is it BoundedRandomActor? Or, BoundedSeqentialActor? Or is it <em>EpsilonActor</em>?</p>
<p>To answer, use the optimized parameters from Q2.2-6 to run a series of experiments, with a variable number of steps. Report the total rewards collected for each of the three agents for the num_steps below. I am not going to do any work for you this time. You’re on your own for the code!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_steps</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your code goes here; Find the best agent for each num_steps.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># When you are done, write the best agent here</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="question-2-8-the-big-conclusion">
<h4>Question 2.8 - the big conclusion!<a class="headerlink" href="#question-2-8-the-big-conclusion" title="Permalink to this headline">¶</a></h4>
<p>Based on what you’ve seen here today, do you think pure exploration is a good way to solve reward learning problems? Assume when you answer that our 4-armed bandit is a good proxy for the real world. (…This is a bad asssumption… deal.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write your answer here, as a comment. Explain yourself.</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="dont-eat-me.html" title="previous page">The Please Don’t Eat Me - Lab</a>
    <a class='right-next' id="next-link" href="oh-no.html" title="next page">The Oh No! - Lab</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Erik J Peterson<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>